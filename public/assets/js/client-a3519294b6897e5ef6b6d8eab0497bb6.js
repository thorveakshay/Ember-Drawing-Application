function findxy(e,o){"down"==e&&(prevX=currX,prevY=currY,currX=o.clientX,currY=o.clientY,flag=!0,(dot_flag=!0)&&(context.beginPath(),context.fillStyle=col,context.fillRect(currX,currY,2,2),context.closePath(),dot_flag=!1)),"up"!=e&&"out"!=e||(flag=!1),"move"==e&&flag&&(prevX=currX,prevY=currY,currX=o.clientX-canvas.offsetLeft,currY=o.clientY-canvas.offsetTop,draw())}function init(){w=canvas.width,h=canvas.height,canvas.addEventListener("mousemove",function(e){findxy("move",e)},!1),canvas.addEventListener("mousedown",function(e){findxy("down",e)},!1),canvas.addEventListener("mouseup",function(e){findxy("up",e)},!1),canvas.addEventListener("mouseout",function(e){findxy("out",e)},!1)}function draw(){context.beginPath(),context.moveTo(prevX,prevY),context.lineTo(currX,currY),context.strokeStyle=col,context.stroke(),context.closePath()}var canvas=document.getElementById("drawing"),context=canvas.getContext("2d"),flag=!1,prevX=0,currX=0,prevY=0,currY=0,dot_flag=!1,w,h,col="gray";window.addEventListener("load",function(){function e(){o.click&&o.move&&o.pos_prev&&(console.log("here"),i.emit("draw_line",{line:[o.pos,o.pos_prev]}),o.move=!1),o.pos_prev={x:o.pos.x,y:o.pos.y},setTimeout(e,25)}var o={click:!1,move:!1,pos:{x:0,y:0},pos_prev:!1},n=document.getElementById("drawing"),c=n.getContext("2d"),t=window.innerWidth,r=window.innerHeight,i=io.connect();n.width=800,n.height=800,n.onmousedown=function(e){o.click=!0},n.onmouseup=function(e){o.click=!1},n.onmousemove=function(e){o.pos.x=e.clientX/t,o.pos.y=e.clientY/r,o.move=!0},i.on("draw_line",function(e){var o=e.line;c.beginPath(),c.moveTo(o[0].x*t,o[0].y*r),c.lineTo(o[1].x*t,o[1].y*r),console.log(col),c.strokeStyle=col,c.stroke()}),i.on("erase",function(){console.log("I am in erase function"),c.clearRect(0,0,n.width,n.height)}),i.on("color",function(e){col=e.col}),e(),$("#clr").click(function(){i.emit("erase",{line:[]})}),$(".color_class").click(function(){switch(this.id){case"green":i.emit("color",{col:"green"});break;case"blue":console.log("blue"),i.emit("color",{col:"blue"});break;case"red":i.emit("color",{col:"red"});break;case"yellow":i.emit("color",{col:"yellow"});break;case"orange":i.emit("color",{col:"orange"});break;case"black":i.emit("color",{col:"black"});break;case"white":i.emit("color",{col:"white"})}})});